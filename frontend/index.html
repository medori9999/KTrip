<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>K-Trip | Home</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700;900&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="style.css">
    <style>
        /* [ë³´ì¡´] íŒ€ì›ë¶„ì˜ ë””ìì¸ ìŠ¤íƒ€ì¼ + í”„ë¡œì íŠ¸ ê³µí†µ ìŠ¤íƒ€ì¼ */
        body { font-family: 'Pretendard', sans-serif; background-color: #e5e7eb; margin: 0; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ (íŒ€ì› ì½”ë“œ ê¸°ë°˜ + z-index ìˆ˜ì •) */
        #overlay { z-index: 100; }
        #modal { z-index: 110; }

        /* ============================================================
           [ìˆ˜ì •] ì¹´ë©”ë¼ ë²„íŠ¼ ë° ë¼ë²¨ ìŠ¤íƒ€ì¼
           ============================================================ */

        /* 1. ì¹´ë©”ë¼ ë²„íŠ¼ (ê¸°ì¡´ ìœ ì§€) */
        .fab-camera {
            position: absolute;
            bottom: 100px; 
            right: 20px;
            width: 50px;
            height: 50px;
            background: #4f46e5; 
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 24px;
            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.4);
            z-index: 90; 
            cursor: pointer;
            transition: transform 0.2s;
        }
        .fab-camera:active { transform: scale(0.9); }

        /* 2. [ì¶”ê°€] Scan Menu ë¼ë²¨ (ë²„íŠ¼ ë°”ë¡œ ìœ„ì— ê³ ì •) */
        .fab-label {
            position: absolute;
            bottom: 154px; /* ë²„íŠ¼(100) + ë†’ì´(50) + ê°„ê²©(10) */
            right: 13px;   /* ë²„íŠ¼ ì¤‘ì•™ì— ë§ê²Œ ìœ„ì¹˜ ì¡°ì • */
            background-color: #1f2937; /* ì§„í•œ íšŒìƒ‰ */
            color: white;
            padding: 2px 6px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: bold;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            z-index: 91; /* ë²„íŠ¼ë³´ë‹¤ ìœ„ì— ë³´ì´ë„ë¡ */
            pointer-events: none; /* í´ë¦­ ë°©í•´ ì•ˆ í•˜ê²Œ */
        }
        
        /* ë¼ë²¨ ê¼¬ë¦¬ (ì•„ë˜ìª½ í™”ì‚´í‘œ) */
        .fab-label::after {
            content: '';
            position: absolute;
            bottom: -4px;
            left: 50%;
            transform: translateX(-50%);
            border-width: 4px 4px 0 4px;
            border-style: solid;
            border-color: #1f2937 transparent transparent transparent;
        }

        /* ìŒì‹ ë¶„ì„ ê²°ê³¼ ëª¨ë‹¬ (Bottom Sheet) */
        .food-modal-bg {
            position: absolute; inset: 0; background: rgba(0,0,0,0.6); 
            display: none; align-items: flex-end; justify-content: center; 
            z-index: 200; 
            backdrop-filter: blur(4px);
        }
        .food-modal {
            background: white; width: 100%; border-top-left-radius: 30px; border-top-right-radius: 30px;
            padding: 30px 25px 100px 25px; 
            animation: slideUp 0.3s ease-out;
            max-height: 85vh; overflow-y: auto;
        }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        
        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loader {
            border: 4px solid #f3f3f3; border-top: 4px solid #4f46e5; 
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="mobile-container relative"> 
        <section class="screen active bg-[#f7f7fb]">
            
            <div class="relative m-4 rounded-3xl overflow-hidden bg-gradient-to-br from-pink-500 to-indigo-500 text-white shadow-lg">
                <div class="p-6">
                    <h1 class="text-2xl font-bold leading-tight">Follow your favorite <br>K-content</h1>
                    <p class="mt-2 text-sm opacity-90 font-medium">Weâ€™ll guide your journey in Korea</p>
                    <div class="mt-5 flex gap-3">
                        <button onclick="location.href='survey.html'" class="flex-1 bg-white/20 backdrop-blur-md border border-white/30 font-bold py-3 rounded-full hover:bg-white/30 transition active:scale-95">
                            Start My Trip <i class="fa-solid fa-arrow-right ml-2"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="px-4 pt-2">
                <h2 class="font-bold text-lg mb-3 text-gray-800">Top K-Contents for You</h2>
                <div class="grid grid-cols-2 gap-3">
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition">
                        <img src="https://static.wikia.nocookie.net/enhypen/images/d/d6/DESIRE_-_UNLEASH.jpg" class="w-full h-[120px] object-cover" />
                        <p class="text-xs font-bold text-center py-2 text-gray-700">K-POP</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition">
                        <img src="https://koreajoongangdaily.joins.com/data/photo/2025/12/04/973917eb-17cb-4580-b845-c5f15f7e764c.jpg" class="w-full h-[120px] object-cover" />
                        <p class="text-xs font-bold text-center py-2 text-gray-700">K-Show</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition">
                        <img src="https://images.justwatch.com/poster/334822828/s718/genie-make-a-wish.jpg" class="w-full h-[120px] object-cover" />
                        <p class="text-xs font-bold text-center py-2 text-gray-700">K-Drama</p>
                    </div>
                    <div class="bg-white rounded-2xl shadow-sm overflow-hidden cursor-pointer hover:shadow-md transition">
                        <img src="https://m.media-amazon.com/images/I/81Mtr7elTnL._AC_SY879_.jpg" class="w-full h-[120px] object-cover" />
                        <p class="text-xs font-bold text-center py-2 text-gray-700">K-Movie</p>
                    </div>
                </div>
            </div>

            <div class="px-4 mt-6">
                <div class="flex items-center justify-between mb-3">
                    <h2 class="font-bold text-lg text-gray-800">Korean Etiquette Tips ğŸ’¡</h2>
                    <span class="text-[10px] text-gray-400 font-bold bg-white px-2 py-1 rounded-full shadow-sm">Tap icons</span>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <button onclick="openTip('restaurant')" class="bg-white rounded-2xl shadow-sm py-4 flex flex-col items-center gap-1 hover:bg-gray-50 transition active:scale-95">
                        <span class="text-2xl">ğŸ½</span><span class="text-[10px] font-bold text-gray-600">Food</span>
                    </button>
                    <button onclick="openTip('cafe')" class="bg-white rounded-2xl shadow-sm py-4 flex flex-col items-center gap-1 hover:bg-gray-50 transition active:scale-95">
                        <span class="text-2xl">â˜•</span><span class="text-[10px] font-bold text-gray-600">CafÃ©</span>
                    </button>
                    <button onclick="openTip('transport')" class="bg-white rounded-2xl shadow-sm py-4 flex flex-col items-center gap-1 hover:bg-gray-50 transition active:scale-95">
                        <span class="text-2xl">ğŸš‡</span><span class="text-[10px] font-bold text-gray-600">Transit</span>
                    </button>
                    <button onclick="openTip('social')" class="bg-white rounded-2xl shadow-sm py-4 flex flex-col items-center gap-1 hover:bg-gray-50 transition active:scale-95">
                        <span class="text-2xl">ğŸ™‹â€â™€ï¸</span><span class="text-[10px] font-bold text-gray-600">Social</span>
                    </button>
                </div>
            </div>

            <div class="px-6 mt-6 pb-24"> <h2 class="font-bold text-lg mb-3 text-gray-800">Most Popular K-Routes</h2>
                <div class="space-y-4">
                    <div class="bg-white rounded-3xl shadow-sm p-4 flex gap-4 items-center border border-gray-100 cursor-pointer hover:border-indigo-100 transition">
                        <img src="https://res.cloudinary.com/kyte/image/upload/w_1080,h_1560,q_auto,f_auto,e_sharpen:50,c_fill,g_auto/v1636358904/hotel/square_lab/KR/65339_46" class="w-[70px] h-[70px] rounded-2xl object-cover shadow-sm" />
                        <div class="flex-1">
                            <p class="text-[10px] text-pink-500 font-black uppercase tracking-wider mb-1">K-Drama Spot</p>
                            <h3 class="text-xs font-bold text-gray-700 leading-relaxed">N Seoul Tower <br>â†’ Namsan Donkatsu <br>â†’ Hanok Village</h3>
                        </div>
                        <i class="fa-solid fa-chevron-right text-gray-300"></i>
                    </div>
                </div>
            </div>
        </section>

        <div id="overlay" onclick="closeTip()" class="hidden absolute inset-0 bg-black/40 backdrop-blur-sm transition-opacity"></div>
        <div id="modal" class="hidden absolute inset-0 flex items-center justify-center px-6 pointer-events-none">
            <div class="bg-white rounded-[32px] w-full max-w-[320px] p-6 shadow-2xl pointer-events-auto transform scale-95 transition-transform duration-200">
                <div class="flex justify-between items-center mb-4 border-b border-gray-100 pb-3">
                    <h3 id="modalTitle" class="font-black text-xl text-gray-800"></h3>
                    <button onclick="closeTip()" class="w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center text-gray-500 hover:bg-gray-200"><i class="fa-solid fa-xmark"></i></button>
                </div>
                <div id="modalContent" class="text-sm text-gray-600 space-y-3 leading-relaxed"></div>
            </div>
        </div>

        <div class="fab-label">Scan Menu</div>

        <div class="fab-camera" onclick="triggerCamera()">
            <i class="fa-solid fa-camera"></i>
        </div>
        
        <input type="file" id="camera-input" accept="image/*" style="display: none;" onchange="handleImageUpload(this)">

        <div id="result-modal" class="food-modal-bg" onclick="if(event.target === this) closeResult()">
            <div class="food-modal">
                <div class="w-12 h-1 bg-gray-300 rounded-full mx-auto mb-6"></div>
                
                <div class="flex justify-between items-center mb-4">
                    <h3 class="text-xl font-black">Menu Analysis</h3>
                    <button onclick="closeResult()" class="text-gray-400"><i class="fa-solid fa-xmark text-xl"></i></button>
                </div>

                <div id="preview-container" class="mb-6 hidden rounded-xl overflow-hidden border border-gray-200 shadow-sm bg-gray-50">
                    <img id="preview-image" src="" class="w-full h-48 object-cover" />
                </div>
                
                <div id="analysis-loader" class="text-center py-10">
                    <div class="loader mx-auto mb-4"></div>
                    <p class="text-indigo-600 font-bold animate-pulse text-sm">AI is reading the menu...</p>
                    <p class="text-gray-400 text-xs mt-2">Connecting to Azure...</p>
                </div>

                <div id="food-list" class="space-y-3 hidden"></div>
            </div>
        </div>
        <nav class="bottom-nav">
            <a href="/" class="nav-item active-tab"> 
                <i class="fa-solid fa-house"></i>
                <span>Home</span>
            </a>
            
            <a href="/chat.html" class="nav-item">
                <i class="fa-solid fa-comment-dots"></i>
                <span>Chat</span>
            </a>
            
            <a href="/saved.html" class="nav-item">
                <i class="fa-solid fa-heart"></i>
                <span>Saved</span>
            </a>
            
            <a href="/photo.html" class="nav-item">
    <i class="fa-solid fa-book-open"></i>
    <span>Log</span>
</a>
        </nav>
    </div>

    <script src="script.js"></script>
    <script>
        // [ê¸°ì¡´] ì—í‹°ì¼“ íŒ ë¡œì§
        const modal = document.getElementById("modal");
        const overlay = document.getElementById("overlay");
        const modalTitle = document.getElementById("modalTitle");
        const modalContent = document.getElementById("modalContent");

        const tips = {
            restaurant: {
                title: "ğŸ½ Restaurant",
                content: `<p class='flex items-start gap-2'><span class='text-indigo-500'>â—</span><span><b>Calling staff is normal.</b><br>Say â€œJeogiyoâ€ (Excuse me) or press the bell on the table.</span></p>
                          <p class='flex items-start gap-2'><span class='text-indigo-500'>â—</span><span><b>Side dishes are free!</b><br>You can ask for refills (Kimchi, etc).</span></p>
                          <p class='flex items-start gap-2'><span class='text-indigo-500'>â—</span><span><b>Pay at the counter</b><br>when you leave, not at the table.</span></p>`
            },
            cafe: {
                title: "â˜• CafÃ©",
                content: `<p class='flex items-start gap-2'><span class='text-pink-500'>â—</span><span><b>Self-service is common.</b><br>Pick up your drink when the buzzer rings.</span></p>
                          <p class='flex items-start gap-2'><span class='text-pink-500'>â—</span><span><b>Return your tray.</b><br>Bring empty cups to the return counter.</span></p>`
            },
            transport: {
                title: "ğŸš‡ Transit",
                content: `<p class='flex items-start gap-2'><span class='text-green-500'>â—</span><span><b>Stand right, walk left</b><br>on escalators.</span></p>
                          <p class='flex items-start gap-2'><span class='text-green-500'>â—</span><span><b>Priority Seats</b><br>Pink seats are for pregnant women, ends are for elderly.</span></p>`
            },
            social: {
                title: "ğŸ™‹â€â™€ï¸ Social",
                content: `<p class='flex items-start gap-2'><span class='text-yellow-500'>â—</span><span><b>Receiving with two hands</b><br>shows respect when giving/taking cards or money.</span></p>
                          <p class='flex items-start gap-2'><span class='text-yellow-500'>â—</span><span><b>Take off shoes</b><br>when entering someone's home.</span></p>`
            }
        };

        function openTip(type) {
            modalTitle.innerHTML = tips[type].title;
            modalContent.innerHTML = tips[type].content;
            overlay.classList.remove("hidden");
            modal.classList.remove("hidden");
            setTimeout(() => { modal.firstElementChild.style.transform = "scale(1)"; }, 10);
        }

        function closeTip() {
            modal.firstElementChild.style.transform = "scale(0.95)";
            setTimeout(() => {
                overlay.classList.add("hidden");
                modal.classList.add("hidden");
            }, 100);
        }

        // ============================================================
        // [ì¶”ê°€] ì¹´ë©”ë¼ ë° ìŒì‹ ë¶„ì„ ìŠ¤í¬ë¦½íŠ¸ (ë¯¸ë¦¬ë³´ê¸° í¬í•¨)
        // ============================================================

        function triggerCamera() {
            document.getElementById('camera-input').click();
        }

        function closeResult() {
            document.getElementById('result-modal').style.display = 'none';
        }

        async function handleImageUpload(input) {
            const file = input.files[0];
            if (!file) return;

            // UI ì¤€ë¹„
            const modal = document.getElementById('result-modal');
            const loader = document.getElementById('analysis-loader');
            const list = document.getElementById('food-list');
            
            // [ì¶”ê°€] ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸° ê¸°ëŠ¥
            const previewContainer = document.getElementById('preview-container');
            const previewImage = document.getElementById('preview-image');

            const reader = new FileReader();
            reader.onload = function(e) {
                previewImage.src = e.target.result;
                previewContainer.classList.remove('hidden'); // ì´ë¯¸ì§€ ë³´ì´ê¸°
            };
            reader.readAsDataURL(file);

            modal.style.display = 'flex';
            loader.style.display = 'block';
            list.style.display = 'none';
            list.innerHTML = ''; 

            const formData = new FormData();
            formData.append('file', file);

            try {
                // ë°±ì—”ë“œ í˜¸ì¶œ
                const response = await fetch('/api/analyze-menu', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                renderFoodResult(data);

            } catch (error) {
                console.error(error);
                list.innerHTML = `<div class="text-center py-10 text-red-500 font-bold">Analysis Failed.<br><span class="text-xs font-normal text-gray-400">Please try again.</span></div>`;
                loader.style.display = 'none';
                list.style.display = 'block';
            }
            
            input.value = '';
        }

        // JSON -> HTML ë³€í™˜
        function renderFoodResult(data) {
            const loader = document.getElementById('analysis-loader');
            const list = document.getElementById('food-list');

            loader.style.display = 'none';
            list.style.display = 'block';

            if (!data.foods || data.foods.length === 0) {
                list.innerHTML = `<p class="text-center text-gray-500 py-10">No text detected.<br>Try taking a clearer photo.</p>`;
                return;
            }

            data.foods.forEach(food => {
                let spicyIcon = '';
                for(let i=0; i<food.spicy_level; i++) spicyIcon += 'ğŸŒ¶ï¸';
                if(food.spicy_level === 0) spicyIcon = 'ğŸ‘¶'; 

                const item = document.createElement('div');
                item.className = 'bg-gray-50 p-4 rounded-2xl border border-gray-100 flex gap-4 items-start';
                item.innerHTML = `
                    <div class="flex-1">
                        <div class="flex justify-between items-start mb-1">
                            <div>
                                <h4 class="font-bold text-gray-900 text-lg">${food.english}</h4>
                                <span class="text-xs text-indigo-500 font-bold">${food.korean}</span>
                            </div>
                            <span class="text-sm font-bold text-gray-700">${food.price ? 'â‚©'+food.price : ''}</span>
                        </div>
                        <p class="text-xs text-gray-500 mb-2 leading-relaxed">${food.description}</p>
                        <div class="flex items-center gap-2 mt-2">
                            <span class="text-[10px] bg-white border border-gray-200 px-2 py-1 rounded-md text-gray-600">Spicy: ${spicyIcon}</span>
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }
    </script>
</body>
</html>