<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <title>K-Trip | Result</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="style.css">
    <style>
        /* Toast ÏïåÎ¶º Ïä§ÌÉÄÏùº */
        .toast {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.9);
            background: white;
            padding: 32px 40px;
            border-radius: 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            opacity: 0;
            transition: all 0.3s ease;
            max-width: 300px;
            text-align: center;
        }

        .toast.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .toast-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            transition: opacity 0.3s ease;
            pointer-events: none;
        }

        .toast-overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        .toast-icon {
            font-size: 56px;
            margin-bottom: 16px;
            animation: bounce 0.6s ease;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }

        .toast-message {
            font-size: 18px;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 8px;
        }

        .toast-submessage {
            font-size: 14px;
            color: #6b7280;
            line-height: 1.4;
        }

        .toast-button {
            margin-top: 20px;
            width: 100%;
            padding: 12px;
            background: #6366f1;
            color: white;
            border: none;
            border-radius: 12px;
            font-weight: 700;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toast-button:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body>
    <div class="mobile-container">
        <section id="scr-result" class="screen active pt-10 px-6">
            <h2 class="text-3xl font-black mb-2 tracking-tighter">Your <span class="text-indigo-600">Soul Route</span></h2>
            <p class="text-xs text-gray-400 mb-8">We found the perfect K-spots for you.</p>
            
            <div id="result-container" class="space-y-2 mt-4">
                <div class="loader mx-auto"></div>
                <p class="text-center text-gray-400 text-xs mt-2">AI is planning your trip...</p>
            </div>

            <div id="map-container" class="mt-6 w-full h-56 bg-gray-200 rounded-2xl overflow-hidden relative border border-gray-100 shadow-inner"></div>
            
            <div class="mt-8 flex gap-3">
                <button onclick="saveRoute()" class="flex-1 bg-rose-500 text-white py-4 rounded-2xl font-black shadow-lg active:scale-95 transition-transform flex items-center justify-center gap-2"><i class="fa-solid fa-heart"></i> Save</button>
                <button onclick="location.href='survey.html'" class="flex-1 bg-slate-900 text-white py-4 rounded-2xl font-black shadow-xl active:scale-95 transition-transform">New Trip</button>
            </div>
        </section>

        <nav class="bottom-nav">
    <a href="/" class="nav-item">
        <i class="fa-solid fa-house"></i><span>Home</span>
    </a>
    <a href="/chat.html" class="nav-item active-tab">
        <i class="fa-solid fa-comment-dots"></i><span>Chat</span>
    </a>
    <a href="/saved.html" class="nav-item">
        <i class="fa-solid fa-heart"></i><span>Saved</span>
    </a>
    <a href="/photo.html" class="nav-item">
        <i class="fa-solid fa-camera"></i><span>Photo</span>
    </a>
</nav>
    </div>

    <script>
        ((g)=>{var h,a,k,p="The Google Maps JavaScript API",c="google",l="importLibrary",q="__ib__",m=document,b=window;b=b[c]||(b[c]={});var d=b.maps||(b.maps={}),r=new Set,e=new URLSearchParams,u=()=>h||(h=new Promise(async(f,n)=>{await(a=m.createElement("script"));e.set("libraries",[...r]+"");for(k in g)e.set(k.replace(/[A-Z]/g,t=>"_"+t[0].toLowerCase()),g[k]);e.set("callback",c+".maps."+q);a.src=`https://maps.${c}apis.com/maps/api/js?`+e;d[q]=f;a.onerror=()=>h=n(Error(p+" could not load."));a.nonce=m.querySelector("script[nonce]")?.nonce||"";m.head.append(a)}));d[l]?console.warn(p+" only loads once. Ignoring:",g):(d[l]=(f,...n)=>r.add(f)&&u().then(()=>d[l](f,...n)))})({ key: "AIzaSyCupkJq4a5oOMYWbPE630TcPuQq9dex4vw", v: "weekly", language: "en" });
    </script>
    <script src="script.js"></script>
    
    <script>
        // Toast ÏïåÎ¶º ÌëúÏãú Ìï®Ïàò
        function showToast(message, submessage = '', icon = 'üíö', showButton = false, buttonText = 'ÌôïÏù∏', buttonCallback = null) {
            // Ïò§Î≤ÑÎ†àÏù¥ ÏÉùÏÑ±
            const overlay = document.createElement('div');
            overlay.className = 'toast-overlay';
            
            // Toast ÏÉùÏÑ±
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-message">${message}</div>
                ${submessage ? `<div class="toast-submessage">${submessage}</div>` : ''}
                ${showButton ? `<button class="toast-button" id="toast-btn">${buttonText}</button>` : ''}
            `;
            
            document.body.appendChild(overlay);
            document.body.appendChild(toast);
            
            // Ïï†ÎãàÎ©îÏù¥ÏÖò Ï†ÅÏö©
            setTimeout(() => {
                overlay.classList.add('show');
                toast.classList.add('show');
            }, 10);
            
            // Îã´Í∏∞ Ìï®Ïàò
            const closeToast = () => {
                overlay.classList.remove('show');
                toast.classList.remove('show');
                setTimeout(() => {
                    overlay.remove();
                    toast.remove();
                }, 300);
            };
            
            // Î≤ÑÌäºÏù¥ ÏûàÏúºÎ©¥ Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            if (showButton) {
                document.getElementById('toast-btn').onclick = () => {
                    closeToast();
                    if (buttonCallback) buttonCallback();
                };
            } else {
                // Î≤ÑÌäºÏù¥ ÏóÜÏúºÎ©¥ 2Ï¥à ÌõÑ ÏûêÎèôÏúºÎ°ú Îã´Í∏∞
                setTimeout(closeToast, 2000);
            }
            
            // Ïò§Î≤ÑÎ†àÏù¥ ÌÅ¥Î¶≠ Ïãú Îã´Í∏∞
            overlay.onclick = closeToast;
        }

        window.addEventListener('load', async () => {
            await initMap();
            const surveyData = JSON.parse(localStorage.getItem('surveyData'));
            
            if (surveyData) {
                try {
                    const response = await fetch("/api/recommend", { 
                        method: "POST", 
                        headers: { "Content-Type": "application/json" }, 
                        body: JSON.stringify(surveyData) 
                    });
                    const data = await response.json();
                    
                    if (data.spots) {
                        localStorage.setItem('currentSpots', JSON.stringify(data.spots));
                        renderResult(data.spots);
                        drawRouteOnMap(data.spots);
                    } else {
                        document.getElementById('result-container').innerHTML = "<p class='text-center text-gray-500'>No spots found matching your vibe.</p>";
                    }
                } catch (error) {
                    console.error(error);
                    document.getElementById('result-container').innerHTML = "<p class='text-center text-red-500'>Error loading route.</p>";
                }
            } else {
                document.getElementById('result-container').innerHTML = "<p class='text-center text-gray-500'>Please complete the survey first.</p>";
            }
        });

        // saveRoute Ìï®Ïàò ÏàòÏ†ï (Í∏∞Ï°¥ script.jsÏùò Ìï®ÏàòÎ•º Ïò§Î≤ÑÎùºÏù¥Îìú)
        function saveRoute() {
            const STORAGE_KEY = 'ktrip_saved_routes';
            const currentSpots = JSON.parse(localStorage.getItem('currentSpots'));
            
            if (!currentSpots || currentSpots.length === 0) {
                showToast('No Route to Save', 'Please generate a route first', '‚ö†Ô∏è', true, 'ÌôïÏù∏');
                return;
            }
            
            const savedData = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
            const newTrip = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                spots: currentSpots
            };
            
            savedData.push(newTrip);
            localStorage.setItem(STORAGE_KEY, JSON.stringify(savedData));
            
            // ÏòàÏÅú toast ÌåùÏóÖ ÌëúÏãú
            showToast(
                'Trip Saved Successfully!', 
                'Check your saved trips anytime', 
                'üíö',
                true,
                'ÌôïÏù∏',
                () => {
                    // Î≤ÑÌäº ÌÅ¥Î¶≠ Ïãú saved.htmlÎ°ú Ïù¥Îèô (ÏÑ†ÌÉùÏÇ¨Ìï≠)
                    // location.href = 'saved.html';
                }
            );
        }
    </script>
</body>
</html>
